{"repo_id": "encode_starlette_792", "bugs": [{"description": "KeyError will be raised if Content-Type header is missing. The code directly accesses self.headers[\"Content-Type\"] without checking if the header exists. This will cause the application to crash when processing multipart form data without a Content-Type header.", "file": "starlette/formparsers.py", "line": 162}, {"description": "None value passed to MultipartParser constructor will cause an exception. If the Content-Type header lacks a boundary parameter, params.get(b\"boundary\") returns None, which is then passed to multipart.MultipartParser(boundary, callbacks), causing the parser to fail.", "file": "starlette/formparsers.py", "line": 181}, {"description": "KeyError will be raised if Content-Disposition header lacks a 'name' parameter. The code directly accesses options[b\"name\"] without checking if the 'name' key exists in the options dictionary. According to RFC 7578, the 'name' parameter is required for multipart form data, but malformed requests could omit it, causing a crash.", "file": "starlette/formparsers.py", "line": 218}, {"description": "HTTP header injection vulnerability in FileResponse. The filename parameter is directly inserted into the Content-Disposition header without proper escaping. If filename contains quotes, newlines, or other special characters, it could allow header injection attacks. For example, a filename like 'test.txt\"\\r\\nX-Malicious: evil' would break out of the header value and inject additional headers.", "file": "starlette/responses.py", "line": 232}, {"description": "JSON parsing will fail with empty body or non-JSON content. The json.loads(body) call on line 202 will raise a JSONDecodeError if the request body is empty (empty bytes) or contains invalid JSON. This will cause the application to crash when calling request.json() on requests with empty or malformed JSON bodies.", "file": "starlette/requests.py", "line": 202}, {"description": "AttributeError will be raised if chunk is not a string or bytes. On line 199, if a chunk from the body_iterator is neither bytes nor a string-like object with an encode() method (e.g., an integer, None, or other object), calling chunk.encode(self.charset) will raise an AttributeError, causing the streaming response to fail.", "file": "starlette/responses.py", "line": 199}, {"description": "AttributeError will be raised if content is not string-like. On line 54, if content is not None, bytes, or a string-like object with an encode() method (e.g., an integer, list, or other object), calling content.encode(self.charset) will raise an AttributeError, causing response creation to fail.", "file": "starlette/responses.py", "line": 54}, {"description": "Parser finalize() is called multiple times in FormParser. In the FormParser.parse() method, finalize() is called every time an empty chunk is encountered (line 96), and potentially multiple times during stream processing. The multipart library may not handle multiple finalize() calls gracefully, potentially causing parsing errors or exceptions.", "file": "starlette/formparsers.py", "line": 96}, {"description": "Cookie parsing can raise CookieError for malformed cookies. The cookie.load(cookie_header) call on line 94 can raise http.cookies.CookieError if the cookie header contains malformed cookie data. This will cause the application to crash when accessing request.cookies with invalid cookie headers.", "file": "starlette/requests.py", "line": 94}], "updated_files": {}}