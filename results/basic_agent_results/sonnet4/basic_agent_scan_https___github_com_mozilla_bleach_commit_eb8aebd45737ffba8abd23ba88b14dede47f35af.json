{"repo_id": "mozilla_bleach_eb8aebd45737ffba8abd23ba88b14dede47f35af", "bugs": [{"description": "In the convert_entities function, line 493 checks 'if part:' but should check 'if remainder:'. The variable 'part' will always be truthy at this point since the loop continues when part is falsy (line 481). This means the remainder will always be appended even when it's empty, potentially adding empty strings to the result.", "file": "./bleach/html5lib_shim.py", "line": 493}, {"description": "In the merge_characters method, lines 330-334 always yield a new Characters token at the end of the function, even when characters_buffer is empty. This will create spurious empty Characters tokens when there are no characters to merge. The code should check if characters_buffer is not empty before creating and yielding the token.", "file": "./bleach/sanitizer.py", "line": 330}, {"description": "In the convert_entity function, there are multiple potential IndexError and ValueError exceptions that are not handled: 1) Line 459 accesses value[0] without checking if value is empty, 2) Line 460 accesses value[1] without checking if len(value) > 1, 3) Lines 461-462 call int() which can raise ValueError for invalid numeric strings, 4) Line 461 accesses value[2:] without checking if len(value) > 2. These could cause crashes when processing malformed entities.", "file": "./bleach/html5lib_shim.py", "line": 459}, {"description": "In the _attr_key function, line 14 accesses attr[0][0] and attr[0][1], but according to the docstring, attr should be a tuple of (namespace, name). This suggests the function expects attr to be ((namespace, name),) but it should probably be accessing attr[0] and attr[1] directly. The current code assumes attr is a nested tuple structure that doesn't match the documented interface.", "file": "./bleach/utils.py", "line": 14}, {"description": "In the INVISIBLE_CHARACTERS definition, line 47 uses range(11, 13) which only includes characters 11 and 12, but the comment on line 45 says it should exclude characters 9 (tab), 10 (lf), and 13 (cr). Character 13 (cr) is not being excluded as intended. The range should be range(11, 12) to exclude character 13, or the range should be range(11, 13) and then character 13 should be explicitly excluded.", "file": "./bleach/sanitizer.py", "line": 47}, {"description": "In the build_url_re function, line 53 uses '|'.join(sorted(protocols)) and '|'.join(sorted(tlds)) to build a regex pattern, but it doesn't escape special regex characters that might be present in the protocols or tlds lists. If any protocol or TLD contains regex metacharacters like '.', '+', '*', etc., they could cause the regex to behave unexpectedly. The values should be escaped using re.escape() before joining.", "file": "./bleach/linkifier.py", "line": 53}, {"description": "In the build_email_re function, line 86 uses '|'.join(tlds) to build a regex pattern, but it doesn't escape special regex characters that might be present in the tlds list. If any TLD contains regex metacharacters like '.', '+', '*', etc., they could cause the regex to behave unexpectedly. The values should be escaped using re.escape() before joining.", "file": "./bleach/linkifier.py", "line": 86}], "updated_files": {}}