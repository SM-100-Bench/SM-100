{ "issues": [ { "file": "langfuse/Sampler.py", "line": 47, "description": "In deterministic_sample, using only the first 8 hex digits of the SHA-256 hash (32 bits) for normalization can lead to a non-uniform distribution. Using all 64 hex digits (256 bits) would provide better uniformity for sampling." }, { "file": "langfuse/Sampler.py", "line": 29, "description": "If 'body' is missing in the event dict, the code logs an error and defaults to returning True, which may leak unintended events and is not a fail-safe default for sampling logic." }, { "file": "langfuse/logging.py", "line": 8, "description": "Calling clean_logger multiple times will add multiple StreamHandlers to the 'httpx' logger, causing duplicate log outputs. Should check if a handler already exists before adding." }, { "file": "langfuse/serializer.py", "line": 112, "description": "In EventSerializer, the encode method calls self.default(obj) before super().encode, effectively double-serializing and potentially breaking standard JSONEncoder expectations, which may cause issues if the object is already serializable." }, { "file": "langfuse/serializer.py", "line": 143, "description": "In EventSerializer.default, when handling objects with slots, only the slots attributes are serialized, but inherited slots are not considered, possibly missing data and causing incomplete serialization." }, { "file": "langfuse/prompt_cache.py", "line": 84, "description": "PromptCacheTaskManager._processing_keys is not thread-safe. Since add_task and _wrap_task can be called from multiple threads, this set should be protected by a lock to avoid race conditions." }, { "file": "langfuse/task_manager.py", "line": 210, "description": "TaskManager.add_task uses a non-blocking put on the queue. If the queue is full, it logs a warning, but the dropped event is silently lost, which could result in data loss without external notification." }, { "file": "langfuse/types/init.py", "line": 7, "description": "Circular import: langfuse/types/init.py imports from langfuse.client, which may in turn import langfuse/types/init.py (directly or indirectly), possibly causing initialization issues." } ] }