{
  "url": "https://github.com/encode/starlette/pull/792",
  "identifier": "encode_starlette_5f194f7",
  "code_blocks": [
    "json\nApply\n[\n\u00a0\u00a0{\n\u00a0\u00a0\u00a0\u00a0\"file\":\u00a0\"starlette/middleware/database.py\",\n\u00a0\u00a0\u00a0\u00a0\"line\":\u00a08,\n\u00a0\u00a0\u00a0\u00a0\"description\":\u00a0\"If\u00a0both\u00a0database_url\u00a0and\u00a0database_config\u00a0are\u00a0None,\u00a0urlparse(database_url)\u00a0will\u00a0raise\u00a0a\u00a0TypeError.\u00a0There\u00a0is\u00a0no\u00a0validation\u00a0that\u00a0at\u00a0least\u00a0one\u00a0is\u00a0provided.\"\n\u00a0\u00a0},\n\u00a0\u00a0{\n\u00a0\u00a0\u00a0\u00a0\"file\":\u00a0\"starlette/middleware/database.py\",\n\u00a0\u00a0\u00a0\u00a0\"line\":\u00a011,\n\u00a0\u00a0\u00a0\u00a0\"description\":\u00a0\"The\u00a0urlparse\u00a0result\u00a0does\u00a0not\u00a0have\u00a0attributes\u00a0'user',\u00a0'password',\u00a0or\u00a0'database'.\u00a0The\u00a0correct\u00a0attributes\u00a0are\u00a0'username',\u00a0'password',\u00a0and\u00a0'path'.\u00a0This\u00a0will\u00a0cause\u00a0AttributeError.\"\n\u00a0\u00a0},\n\u00a0\u00a0{\n\u00a0\u00a0\u00a0\u00a0\"file\":\u00a0\"starlette/middleware/database.py\",\n\u00a0\u00a0\u00a0\u00a0\"line\":\u00a011,\n\u00a0\u00a0\u00a0\u00a0\"description\":\u00a0\"parsed.path\u00a0will\u00a0include\u00a0a\u00a0leading\u00a0slash,\u00a0which\u00a0may\u00a0cause\u00a0connection\u00a0issues\u00a0with\u00a0asyncpg\u00a0if\u00a0not\u00a0stripped.\"\n\u00a0\u00a0},\n\u00a0\u00a0{\n\u00a0\u00a0\u00a0\u00a0\"file\":\u00a0\"starlette/middleware/database.py\",\n\u00a0\u00a0\u00a0\u00a0\"line\":\u00a019,\n\u00a0\u00a0\u00a0\u00a0\"description\":\u00a0\"Calling\u00a0asyncio.get_event_loop()\u00a0and\u00a0run_until_complete()\u00a0in\u00a0__init__\u00a0can\u00a0cause\u00a0issues\u00a0if\u00a0the\u00a0event\u00a0loop\u00a0is\u00a0already\u00a0running\u00a0(e.g.,\u00a0in\u00a0an\u00a0async\u00a0context\u00a0or\u00a0under\u00a0uvicorn).\u00a0This\u00a0can\u00a0raise\u00a0RuntimeError.\"\n\u00a0\u00a0},\n\u00a0\u00a0{\n\u00a0\u00a0\u00a0\u00a0\"file\":\u00a0\"starlette/middleware/database.py\",\n\u00a0\u00a0\u00a0\u00a0\"line\":\u00a025,\n\u00a0\u00a0\u00a0\u00a0\"description\":\u00a0\"The\u00a0__call__\u00a0method\u00a0is\u00a0not\u00a0async\u00a0and\u00a0does\u00a0not\u00a0await\u00a0anything,\u00a0but\u00a0it\u00a0returns\u00a0self.app(scope)\u00a0directly.\u00a0If\u00a0self.app\u00a0is\u00a0an\u00a0ASGI\u00a0app,\u00a0it\u00a0should\u00a0be\u00a0called\u00a0with\u00a0(scope,\u00a0receive,\u00a0send)\u00a0and\u00a0be\u00a0async.\u00a0This\u00a0will\u00a0break\u00a0ASGI\u00a0contract.\"\n\u00a0\u00a0},\n\u00a0\u00a0{\n\u00a0\u00a0\u00a0\u00a0\"file\":\u00a0\"starlette/multipart.py\",\n\u00a0\u00a0\u00a0\u00a0\"line\":\u00a019,\n\u00a0\u00a0\u00a0\u00a0\"description\":\u00a0\"default_stream_factory\u00a0and\u00a0MultiDict\u00a0are\u00a0used\u00a0but\u00a0never\u00a0defined\u00a0or\u00a0imported.\u00a0This\u00a0will\u00a0cause\u00a0NameError.\"\n\u00a0\u00a0},\n\u00a0\u00a0{\n\u00a0\u00a0\u00a0\u00a0\"file\":\u00a0\"starlette/multipart.py\",\n\u00a0\u00a0\u00a0\u00a0\"line\":\u00a087,\n\u00a0\u00a0\u00a0\u00a0\"description\":\u00a0\"exceptions.RequestEntityTooLarge\u00a0is\u00a0raised,\u00a0but\u00a0exceptions\u00a0is\u00a0not\u00a0defined\u00a0or\u00a0imported.\u00a0This\u00a0will\u00a0cause\u00a0NameError.\"\n\u00a0\u00a0},\n\u00a0\u00a0{\n\u00a0\u00a0\u00a0\u00a0\"file\":\u00a0\"starlette/multipart.py\",\n\u00a0\u00a0\u00a0\u00a0\"line\":\u00a0109,\n\u00a0\u00a0\u00a0\u00a0\"description\":\u00a0\"_supported_multipart_encodings\u00a0is\u00a0referenced\u00a0but\u00a0never\u00a0defined\u00a0or\u00a0imported.\u00a0This\u00a0will\u00a0cause\u00a0NameError.\"\n\u00a0\u00a0},\n\u00a0\u00a0{\n\u00a0\u00a0\u00a0\u00a0\"file\":\u00a0\"starlette/multipart.py\",\n\u00a0\u00a0\u00a0\u00a0\"line\":\u00a0120,\n\u00a0\u00a0\u00a0\u00a0\"description\":\u00a0\"parse_options_header\u00a0is\u00a0used\u00a0but\u00a0never\u00a0defined\u00a0or\u00a0imported.\u00a0This\u00a0will\u00a0cause\u00a0NameError.\"\n\u00a0\u00a0},\n\u00a0\u00a0{\n\u00a0\u00a0\u00a0\u00a0\"file\":\u00a0\"starlette/multipart.py\",\n\u00a0\u00a0\u00a0\u00a0\"line\":\u00a0256,\n\u00a0\u00a0\u00a0\u00a0\"description\":\u00a0\"FileStorage\u00a0is\u00a0used\u00a0but\u00a0never\u00a0defined\u00a0or\u00a0imported.\u00a0This\u00a0will\u00a0cause\u00a0NameError.\"\n\u00a0\u00a0},\n\u00a0\u00a0{\n\u00a0\u00a0\u00a0\u00a0\"file\":\u00a0\"starlette/multipart.py\",\n\u00a0\u00a0\u00a0\u00a0\"line\":\u00a0359,\n\u00a0\u00a0\u00a0\u00a0\"description\":\u00a0\"tee\u00a0is\u00a0used\u00a0but\u00a0never\u00a0defined\u00a0or\u00a0imported.\u00a0This\u00a0will\u00a0cause\u00a0NameError.\"\n\u00a0\u00a0},\n\u00a0\u00a0{\n\u00a0\u00a0\u00a0\u00a0\"file\":\u00a0\"starlette/multipart.py\",\n\u00a0\u00a0\u00a0\u00a0\"line\":\u00a0320,\n\u00a0\u00a0\u00a0\u00a0\"description\":\u00a0\"to_native\u00a0and\u00a0_line_parse\u00a0are\u00a0used\u00a0but\u00a0never\u00a0defined\u00a0or\u00a0imported.\u00a0This\u00a0will\u00a0cause\u00a0NameError.\"\n\u00a0\u00a0},\n\u00a0\u00a0{\n\u00a0\u00a0\u00a0\u00a0\"file\":\u00a0\"starlette/multipart.py\",\n\u00a0\u00a0\u00a0\u00a0\"line\":\u00a019,\n\u00a0\u00a0\u00a0\u00a0\"description\":\u00a0\"No\u00a0input\u00a0validation\u00a0or\u00a0size\u00a0checks\u00a0on\u00a0uploaded\u00a0files\u00a0or\u00a0form\u00a0fields,\u00a0which\u00a0could\u00a0lead\u00a0to\u00a0denial\u00a0of\u00a0service\u00a0(DoS)\u00a0via\u00a0large\u00a0uploads.\"\n\u00a0\u00a0},\n\u00a0\u00a0{\n\u00a0\u00a0\u00a0\u00a0\"file\":\u00a0\"starlette/response.py\",\n\u00a0\u00a0\u00a0\u00a0\"line\":\u00a044,\n\u00a0\u00a0\u00a0\u00a0\"description\":\u00a0\"In\u00a0Response.init_headers,\u00a0the\u00a0logic\u00a0for\u00a0populate_content_length\u00a0and\u00a0populate_content_type\u00a0is\u00a0inverted.\u00a0It\u00a0appends\u00a0content-length\u00a0and\u00a0content-type\u00a0headers\u00a0only\u00a0if\u00a0they\u00a0are\u00a0already\u00a0present\u00a0in\u00a0the\u00a0input\u00a0headers,\u00a0which\u00a0is\u00a0the\u00a0opposite\u00a0of\u00a0the\u00a0intended\u00a0behavior.\"\n\u00a0\u00a0},\n\u00a0\u00a0{\n\u00a0\u00a0\u00a0\u00a0\"file\":\u00a0\"starlette/response.py\",\n\u00a0\u00a0\u00a0\u00a0\"line\":\u00a0153,\n\u00a0\u00a0\u00a0\u00a0\"description\":\u00a0\"FileResponse\u00a0does\u00a0not\u00a0check\u00a0if\u00a0the\u00a0file\u00a0exists\u00a0before\u00a0trying\u00a0to\u00a0open\u00a0it.\u00a0This\u00a0will\u00a0raise\u00a0an\u00a0exception\u00a0if\u00a0the\u00a0file\u00a0is\u00a0missing.\"\n\u00a0\u00a0},\n\u00a0\u00a0{\n\u00a0\u00a0\u00a0\u00a0\"file\":\u00a0\"starlette/response.py\",\n\u00a0\u00a0\u00a0\u00a0\"line\":\u00a0158,\n\u00a0\u00a0\u00a0\u00a0\"description\":\u00a0\"FileResponse\u00a0sends\u00a0'more_body':\u00a0False\u00a0for\u00a0every\u00a0chunk,\u00a0which\u00a0is\u00a0incorrect\u00a0for\u00a0ASGI\u00a0streaming.\u00a0It\u00a0should\u00a0send\u00a0'more_body':\u00a0True\u00a0for\u00a0all\u00a0but\u00a0the\u00a0last\u00a0chunk.\"\n\u00a0\u00a0}\n]"
  ],
  "timestamp": "2025-05-26 16:29:35"
}